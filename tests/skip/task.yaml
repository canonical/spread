summary: Test the skip condition feature

prepare: |
    if [ ! -f .spread-reuse.yaml ]; then
        touch /run/spread-reuse.yaml
        ln -s /run/spread-reuse.yaml .spread-reuse.yaml
    fi

execute: |
    # Check when the skip condition matches
    MY_TEST_VAR=true spread -reuse -resend &> task1.out
    grep 'Skipped tasks: 1' task1.out
    grep 'Skipping' task1.out

    # Check when the skip condition doesn't match
    MY_TEST_VAR=false spread -reuse -resend &> task1.out
    grep 'Failed tasks: 1' task1.out
    grep -v 'Skipping' task1.out

debug: |
    cat task1.out || true
    cat task2.out || true
